```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chrono Legends Sprite Studio PRO</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --secondary: #7c3aed;
      --accent: #60a5fa;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #0f172a;
      --darker: #0a0f1d;
      --light: #e2e8f0;
      --gray: #334155;
      --panel-bg: rgba(22, 38, 77, 0.85);
      --border-radius: 16px;
      --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      --transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    body {
      background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
      color: var(--light);
      min-height: 100vh;
      padding: 20px;
      background-attachment: fixed;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(79, 70, 229, 0.15) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(124, 58, 237, 0.15) 0%, transparent 20%);
    }

    .app-container {
      max-width: 1600px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 300px 1fr;
      grid-template-rows: auto 1fr auto;
      gap: 20px;
      height: calc(100vh - 40px);
    }

    .app-header {
      grid-column: 1 / -1;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
      z-index: 10;
    }

    .app-header::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      transform: rotate(30deg);
      z-index: -1;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      width: 60px;
      height: 60px;
      background: linear-gradient(45deg, var(--accent), var(--secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      box-shadow: 0 0 20px rgba(99, 102, 241, 0.7);
    }

    h1 {
      font-size: 2.5rem;
      background: linear-gradient(to right, #60a5fa, #8b5cf6, #f472b6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      letter-spacing: 1px;
    }

    .subtitle {
      font-size: 1.2rem;
      max-width: 700px;
      color: rgba(255, 255, 255, 0.9);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      margin-top: 5px;
    }

    .toolbar {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      padding: 15px;
      border-radius: var(--border-radius);
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      box-shadow: var(--shadow-md);
      border: 1px solid rgba(79, 70, 229, 0.3);
    }

    .toolbar-btn {
      background: linear-gradient(to bottom, rgba(79, 70, 229, 0.8), rgba(59, 46, 220, 0.8));
      color: white;
      border: none;
      padding: 10px 18px;
      font-size: 0.95rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .toolbar-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(79, 70, 229, 0.4);
      background: linear-gradient(to bottom, rgba(99, 102, 241, 0.9), rgba(79, 70, 229, 0.9));
    }

    .toolbar-btn:active {
      transform: translateY(0);
    }

    .toolbar-btn i {
      font-size: 1.1rem;
    }

    .toolbar-btn.secondary {
      background: linear-gradient(to bottom, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
      border: 1px solid var(--gray);
    }

    .toolbar-btn.secondary:hover {
      background: linear-gradient(to bottom, rgba(45, 55, 72, 0.9), rgba(30, 41, 59, 0.9));
      border-color: var(--accent);
    }

    .toolbar-btn.danger {
      background: linear-gradient(to bottom, rgba(220, 38, 38, 0.8), rgba(185, 28, 28, 0.8));
    }

    .toolbar-btn.danger:hover {
      background: linear-gradient(to bottom, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
    }

    .toolbar-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .panel {
      background: var(--panel-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-md);
      border: 1px solid rgba(79, 70, 229, 0.3);
      backdrop-filter: blur(10px);
      overflow: auto;
      display: flex;
      flex-direction: column;
    }

    .panel-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      color: var(--accent);
      font-size: 1.4rem;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(79, 70, 229, 0.3);
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding-right: 5px;
    }

    .controls-panel {
      grid-column: 1;
      grid-row: 2;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .preview-panel {
      grid-column: 2;
      grid-row: 2;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .canvas-container {
      background: rgba(15, 23, 42, 0.7);
      border-radius: var(--border-radius);
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      border: 2px solid rgba(79, 70, 229, 0.5);
      box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
    }

    #sprite-canvas-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      height: 600px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #sprite-canvas {
      border: 3px solid var(--primary);
      border-radius: 12px;
      image-rendering: pixelated;
      box-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
      background: linear-gradient(45deg, #0f172a 0%, #1e293b 100%);
      max-width: 100%;
      max-height: 100%;
    }

    .layer-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .layer-btn {
      background: rgba(30, 41, 59, 0.7);
      border: 1px solid rgba(79, 70, 229, 0.5);
      color: var(--light);
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
    }

    .layer-btn:hover {
      background: rgba(79, 70, 229, 0.3);
    }

    .layer-btn.active {
      background: rgba(79, 70, 229, 0.6);
      border-color: var(--accent);
      font-weight: bold;
    }

    .style-section {
      margin-bottom: 25px;
    }

    .section-title {
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .style-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 12px;
    }

    .style-card {
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      height: 120px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      border: 2px solid transparent;
      background: rgba(30, 41, 59, 0.5);
    }

    .style-card:hover, .style-card.selected {
      transform: scale(1.05);
      border-color: var(--accent);
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.4);
    }

    .style-card.selected::after {
      content: "✓";
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 1.2rem;
      color: var(--success);
      font-weight: bold;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      z-index: 2;
    }

    .style-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      padding: 5px;
    }

    .style-name {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 6px;
      font-size: 0.85rem;
      text-align: center;
      backdrop-filter: blur(5px);
      z-index: 1;
    }

    .palette-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .color-swatch {
      width: 100%;
      height: 40px;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .color-swatch:hover {
      transform: scale(1.1);
      border-color: white;
    }

    .color-swatch.selected {
      border-color: white;
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.5);
    }

    .color-swatch::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, rgba(255, 255, 255, 0.1), transparent);
    }

    .slider-control {
      margin: 15px 0;
    }

    .slider-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    .slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: rgba(79, 70, 229, 0.3);
      outline: none;
      -webkit-appearance: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      box-shadow: 0 0 10px rgba(99, 102, 241, 0.7);
    }

    .upload-area {
      border: 3px dashed rgba(79, 70, 229, 0.5);
      border-radius: 12px;
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      margin-bottom: 20px;
      background: rgba(30, 41, 59, 0.3);
      position: relative;
      overflow: hidden;
    }

    .upload-area::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(79, 70, 229, 0.1), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: rotate(45deg) translateX(-100%); }
      100% { transform: rotate(45deg) translateX(100%); }
    }

    .upload-area:hover, .upload-area.drag-over {
      background: rgba(79, 70, 229, 0.1);
      border-color: var(--accent);
    }

    .upload-icon {
      font-size: 3.5rem;
      color: var(--accent);
      margin-bottom: 15px;
    }

    .file-input {
      display: none;
    }

    .animation-preview {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .animation-frame {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      border: 2px solid rgba(79, 70, 229, 0.5);
      background: rgba(15, 23, 42, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: var(--light);
      cursor: pointer;
      transition: var(--transition);
    }

    .animation-frame:hover {
      transform: scale(1.1);
      border-color: var(--accent);
    }

    .animation-frame.active {
      border-color: var(--accent);
      background: rgba(79, 70, 229, 0.3);
      font-weight: bold;
    }

    .app-footer {
      grid-column: 1 / -1;
      text-align: center;
      padding: 15px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      border-top: 1px solid rgba(79, 70, 229, 0.3);
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(5px);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 12px;
      color: white;
      font-weight: 500;
      box-shadow: var(--shadow-lg);
      transform: translateX(150%);
      transition: transform 0.4s ease, opacity 0.4s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 12px;
      max-width: 350px;
      opacity: 0;
    }

    .notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    .notification.success {
      background: linear-gradient(to right, var(--success), #059669);
    }

    .notification.error {
      background: linear-gradient(to right, var(--danger), #dc2626);
    }

    .notification.warning {
      background: linear-gradient(to right, var(--warning), #d97706);
    }

    .notification i {
      font-size: 1.5rem;
    }

    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 42, 0.95);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      backdrop-filter: blur(5px);
    }

    .spinner-container {
      position: relative;
      width: 120px;
      height: 120px;
      margin-bottom: 30px;
    }

    .spinner {
      width: 100%;
      height: 100%;
      border: 6px solid rgba(79, 70, 229, 0.3);
      border-top: 6px solid var(--accent);
      border-radius: 50%;
      animation: spin 1.2s linear infinite;
    }

    .spinner-inner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      border: 4px solid rgba(124, 58, 237, 0.3);
      border-left: 4px solid var(--secondary);
      border-radius: 50%;
      animation: spin 1.5s linear infinite reverse;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
      margin-bottom: 10px;
      text-align: center;
      background: linear-gradient(to right, var(--accent), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .loading-subtext {
      color: rgba(255, 255, 255, 0.7);
      font-size: 1.1rem;
      text-align: center;
      max-width: 600px;
      line-height: 1.5;
    }

    .progress-bar {
      width: 300px;
      height: 10px;
      background: rgba(79, 70, 229, 0.3);
      border-radius: 5px;
      margin-top: 20px;
      overflow: hidden;
    }

    .progress {
      height: 100%;
      background: linear-gradient(to right, var(--accent), var(--secondary));
      border-radius: 5px;
      width: 0%;
      transition: width 0.4s ease;
    }

    .magic-particle {
      position: absolute;
      pointer-events: none;
      z-index: 999;
      opacity: 0;
    }

    .watermark {
      position: absolute;
      bottom: 15px;
      right: 15px;
      color: rgba(255, 255, 255, 0.3);
      font-size: 0.9rem;
      font-weight: 500;
      letter-spacing: 1px;
      z-index: 1;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 10px;
      margin-top: 15px;
      font-size: 0.9rem;
      border: 1px solid rgba(79, 70, 229, 0.3);
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
    }

    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      border-bottom: 2px solid rgba(79, 70, 229, 0.3);
      padding-bottom: 10px;
    }

    .tab-btn {
      padding: 8px 16px;
      background: rgba(30, 41, 59, 0.5);
      border: none;
      border-radius: 8px 8px 0 0;
      color: var(--light);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }

    .tab-btn:hover {
      background: rgba(79, 70, 229, 0.3);
    }

    .tab-btn.active {
      background: rgba(79, 70, 229, 0.6);
      color: white;
      font-weight: 600;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .preset-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .preset-card {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      border: 2px solid transparent;
    }

    .preset-card:hover {
      transform: translateY(-3px);
      border-color: var(--accent);
      background: rgba(79, 70, 229, 0.1);
    }

    .preset-card h4 {
      margin-bottom: 8px;
      color: var(--accent);
      font-size: 1.1rem;
    }

    .preset-card p {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.7);
    }

    @media (max-width: 1200px) {
      .app-container {
        grid-template-columns: 1fr;
        height: auto;
      }
      
      .controls-panel, .preview-panel {
        grid-column: 1;
        grid-row: auto;
      }
      
      .canvas-container {
        height: 500px;
      }
    }

    @media (max-width: 768px) {
      .app-header {
        padding: 15px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .subtitle {
        font-size: 1rem;
      }
      
      .toolbar {
        flex-direction: column;
        gap: 10px;
      }
      
      .canvas-container {
        height: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="app-header">
      <div class="header-content">
        <div class="brand">
          <div class="logo">
            <i class="fas fa-magic"></i>
          </div>
          <div>
            <h1>Chrono Legends Sprite Studio PRO</h1>
            <p class="subtitle">Sistema de generación profesional de sprites con efectos mágicos avanzados y personalización completa</p>
          </div>
        </div>
        <div class="toolbar">
          <button class="toolbar-btn" id="new-project-btn">
            <i class="fas fa-plus"></i> Nuevo Proyecto
          </button>
          <button class="toolbar-btn secondary" id="open-project-btn">
            <i class="fas fa-folder-open"></i> Abrir Proyecto
          </button>
          <button class="toolbar-btn" id="save-project-btn">
            <i class="fas fa-save"></i> Guardar Proyecto
          </button>
          <button class="toolbar-btn secondary" id="export-btn">
            <i class="fas fa-download"></i> Exportar
          </button>
          <button class="toolbar-btn danger" id="reset-btn">
            <i class="fas fa-redo"></i> Reiniciar
          </button>
        </div>
      </div>
    </div>

    <div class="controls-panel">
      <div class="panel">
        <h2 class="panel-title"><i class="fas fa-upload"></i> Imagen Base</h2>
        <div class="panel-content">
          <div class="upload-area" id="drop-area">
            <div class="upload-icon">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <p>Arrastra y suelta tu imagen aquí</p>
            <p class="subtitle" style="font-size: 0.9rem; color: #94a3b8;">Soporta PNG, JPG, GIF con transparencia (máx. 10MB)</p>
            <button class="toolbar-btn" id="browse-btn">
              <i class="fas fa-search"></i> Buscar Archivo
            </button>
            <input type="file" id="file-input" class="file-input" accept="image/*">
          </div>

          <div class="info-box" style="background: rgba(30, 41, 59, 0.5); border-radius: 12px; padding: 15px; margin-top: 15px; border-left: 3px solid var(--accent);">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
              <i class="fas fa-lightbulb" style="color: var(--accent); font-size: 1.2rem;"></i>
              <strong style="color: var(--accent);">Tips Profesionales</strong>
            </div>
            <ul style="text-align: left; padding-left: 20px; line-height: 1.6;">
              <li>Imágenes con fondo transparente dan mejores resultados</li>
              <li>Personajes en pose frontal o 3/4 para mayor precisión</li>
              <li>Resolución mínima recomendada: 512x512px</li>
              <li>Colores vibrantes mejoran los efectos mágicos</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="panel">
        <h2 class="panel-title"><i class="fas fa-palette"></i> Personalización</h2>
        <div class="panel-content">
          <div class="tabs">
            <button class="tab-btn active" data-tab="style">Estilo</button>
            <button class="tab-btn" data-tab="effects">Efectos</button>
            <button class="tab-btn" data-tab="weapons">Armas</button>
            <button class="tab-btn" data-tab="animation">Animación</button>
          </div>

          <div class="tab-content active" id="style-tab">
            <div class="style-section">
              <h3 class="section-title"><i class="fas fa-user"></i> Clase de Personaje</h3>
              <div class="style-grid">
                <div class="style-card selected" data-style="warrior">
                  <div class="style-img" style="background: linear-gradient(45deg, #1e40af, #1d4ed8);">
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                      <i class="fas fa-swords"></i>
                    </div>
                  </div>
                  <div class="style-name">Guerrero</div>
                </div>
                
                <div class="style-card" data-style="mage">
                  <div class="style-img" style="background: linear-gradient(45deg, #7c3aed, #8b5cf6);">
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                      <i class="fas fa-hat-wizard"></i>
                    </div>
                  </div>
                  <div class="style-name">Mago</div>
                </div>
                
                <div class="style-card" data-style="archer">
                  <div class="style-img" style="background: linear-gradient(45deg, #166534, #22c55e);">
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                      <i class="fas fa-bow-arrow"></i>
                    </div>
                  </div>
                  <div class="style-name">Arquero</div>
                </div>
                
                <div class="style-card" data-style="rogue">
                  <div class="style-img" style="background: linear-gradient(45deg, #1e293b, #334155);">
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                      <i class="fas fa-mask"></i>
                    </div>
                  </div>
                  <div class="style-name">Pícaro</div>
                </div>
                
                <div class="style-card" data-style="priest">
                  <div class="style-img" style="background: linear-gradient(45deg, #1d4ed8, #3b82f6);">
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                      <i class="fas fa-cross"></i>
                    </div>
                  </div>
                  <div class="style-name">Sacerdote</div>
                </div>
                
                <div class="style-card" data-style="assassin">
                  <div class="style-img" style="background: linear-gradient(45deg, #92400e, #f97316);">
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                      <i class="fas fa-dagger"></i>
                    </div>
                  </div>
                  <div class="style-name">Asesino</div>
                </div>
              </div>
            </div>

            <div class="style-section">
              <h3 class="section-title"><i class="fas fa-tint"></i> Paleta de Colores</h3>
              <div class="palette-grid">
                <div class="color-swatch selected" style="background: linear-gradient(45deg, #4f46e5, #7c3aed);" data-color="#60a5fa"></div>
                <div class="color-swatch" style="background: linear-gradient(45deg, #1e40af, #1d4ed8);" data-color="#3b82f6"></div>
                <div class="color-swatch" style="background: linear-gradient(45deg, #7c3aed, #8b5cf6);" data-color="#8b5cf6"></div>
                <div class="color-swatch" style="background: linear-gradient(45deg, #f59e0b, #fdba74);" data-color="#f59e0b"></div>
                <div class="color-swatch" style="background: linear-gradient(45deg, #166534, #22c55e);" data-color="#22c55e"></div>
                <div class="color-swatch" style="background: linear-gradient(45deg, #dc2626, #f87171);" data-color="#ef4444"></div>
                <div class="color-swatch" style="background: linear-gradient(45deg, #4f46e5, #818cf8);" data-color="#6366f1"></div>
                <div class="color-swatch" style="background: linear-gradient(45deg, #92400e, #f97316);" data-color="#f97316"></div>
              </div>
            </div>

            <div class="style-section">
              <h3 class="section-title"><i class="fas fa-sliders-h"></i> Parámetros Avanzados</h3>
              <div class="slider-control">
                <div class="slider-label">
                  <span><i class="fas fa-sparkles"></i> Intensidad de Efectos</span>
                  <span id="effect-intensity-value">75%</span>
                </div>
                <input type="range" class="slider" min="0" max="100" value="75" id="effect-intensity">
              </div>
              
              <div class="slider-control">
                <div class="slider-label">
                  <span><i class="fas fa-lightbulb"></i> Brillo</span>
                  <span id="brightness-value">65%</span>
                </div>
                <input type="range" class="slider" min="0" max="100" value="65" id="brightness">
              </div>
              
              <div class="slider-control">
                <div class="slider-label">
                  <span><i class="fas fa-paint-brush"></i> Suavizado</span>
                  <span id="smoothness-value">40%</span>
                </div>
                <input type="range" class="slider" min="0" max="100" value="40" id="smoothness">
              </div>
            </div>
          </div>

          <div class="tab-content" id="effects-tab">
            <div class="preset-grid">
              <div class="preset-card" data-effect="fire">
                <h4><i class="fas fa-fire" style="color: #f97316;"></i> Aura de Fuego</h4>
                <p>Efecto de llamas dinámicas con partículas rojas y naranjas</p>
              </div>
              
              <div class="preset-card" data-effect="ice">
                <h4><i class="fas fa-snowflake" style="color: #38bdf8;"></i> Aura de Hielo</h4>
                <p>Cristales de hielo y partículas azules brillantes</p>
              </div>
              
              <div class="preset-card" data-effect="lightning">
                <h4><i class="fas fa-bolt" style="color: #fbbf24;"></i> Aura de Rayo</h4>
                <p>Rayos eléctricos con destellos amarillos y blancos</p>
              </div>
              
              <div class="preset-card" data-effect="poison">
                <h4><i class="fas fa-skull" style="color: #84cc16;"></i> Aura Venenosa</h4>
                <p>Niebla verde tóxica con burbujas venenosas</p>
              </div>
              
              <div class="preset-card" data-effect="holy">
                <h4><i class="fas fa-dove" style="color: #f1f5f9;"></i> Aura Sagrada</h4>
                <p>Brillo dorado con partículas de luz divina</p>
              </div>
              
              <div class="preset-card" data-effect="shadow">
                <h4><i class="fas fa-moon" style="color: #94a3b8;"></i> Aura Oscura</h4>
                <p>Sombras dinámicas con partículas púrpuras</p>
              </div>
            </div>
          </div>

          <div class="tab-content" id="weapons-tab">
            <div class="style-grid">
              <div class="style-card selected" data-weapon="sword">
                <div class="style-img" style="background: linear-gradient(45deg, #1e40af, #3b82f6);">
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                    <i class="fas fa-sword"></i>
                  </div>
                </div>
                <div class="style-name">Espada Azul</div>
              </div>
              
              <div class="style-card" data-weapon="staff">
                <div class="style-img" style="background: linear-gradient(45deg, #7c3aed, #8b5cf6);">
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                    <i class="fas fa-staff"></i>
                  </div>
                </div>
                <div class="style-name">Bastón Mágico</div>
              </div>
              
              <div class="style-card" data-weapon="bow">
                <div class="style-img" style="background: linear-gradient(45deg, #166534, #22c55e);">
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                    <i class="fas fa-bow"></i>
                  </div>
                </div>
                <div class="style-name">Arco Élfico</div>
              </div>
              
              <div class="style-card" data-weapon="axe">
                <div class="style-img" style="background: linear-gradient(45deg, #92400e, #f97316);">
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                    <i class="fas fa-axe"></i>
                  </div>
                </div>
                <div class="style-name">Hacha de Guerra</div>
              </div>
              
              <div class="style-card" data-weapon="dagger">
                <div class="style-img" style="background: linear-gradient(45deg, #1e293b, #64748b);">
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                    <i class="fas fa-dagger"></i>
                  </div>
                </div>
                <div class="style-name">Daga Mística</div>
              </div>
              
              <div class="style-card" data-weapon="hammer">
                <div class="style-img" style="background: linear-gradient(45deg, #78350f, #f59e0b);">
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                    <i class="fas fa-hammer-war"></i>
                  </div>
                </div>
                <div class="style-name">Martillo Sagrado</div>
              </div>
            </div>
          </div>

          <div class="tab-content" id="animation-tab">
            <h3 class="section-title"><i class="fas fa-play"></i> Tipo de Animación</h3>
            <div class="preset-grid">
              <div class="preset-card" data-animation="idle">
                <h4><i class="fas fa-user-clock"></i> Idle</h4>
                <p>Animación de respiración sutil</p>
              </div>
              
              <div class="preset-card" data-animation="attack">
                <h4><i class="fas fa-fist-raised"></i> Ataque</h4>
                <p>Secuencia de ataque con arma</p>
              </div>
              
              <div class="preset-card" data-animation="spell">
                <h4><i class="fas fa-magic"></i> Hechizo</h4>
                <p>Efectos mágicos con partículas</p>
              </div>
            </div>

            <h3 class="section-title" style="margin-top: 20px;"><i class="fas fa-film"></i> Vista Previa de Frames</h3>
            <div class="animation-preview">
              <div class="animation-frame active">1</div>
              <div class="animation-frame">2</div>
              <div class="animation-frame">3</div>
              <div class="animation-frame">4</div>
              <div class="animation-frame">5</div>
              <div class="animation-frame">6</div>
              <div class="animation-frame">7</div>
              <div class="animation-frame">8</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="preview-panel">
      <div class="panel" style="height: 100%;">
        <h2 class="panel-title"><i class="fas fa-eye"></i> Vista Previa en Tiempo Real</h2>
        <div class="panel-content" style="flex: 1; display: flex; flex-direction: column;">
          <div class="canvas-container">
            <div id="sprite-canvas-container">
              <canvas id="sprite-canvas" width="512" height="512"></canvas>
              <div class="watermark">Chrono Legends Sprite Studio PRO</div>
            </div>
            <div class="layer-controls">
              <button class="layer-btn active" data-layer="all"><i class="fas fa-layer-group"></i> Todo</button>
              <button class="layer-btn" data-layer="character"><i class="fas fa-user"></i> Personaje</button>
              <button class="layer-btn" data-layer="weapon"><i class="fas fa-sword"></i> Arma</button>
              <button class="layer-btn" data-layer="effects"><i class="fas fa-sparkles"></i> Efectos</button>
              <button class="layer-btn" data-layer="background"><i class="fas fa-mountain"></i> Fondo</button>
            </div>
          </div>

          <div class="status-bar">
            <div class="status-item">
              <div class="status-indicator"></div>
              <span>Listo para generar</span>
            </div>
            <div class="status-item">
              <i class="fas fa-ruler-combined"></i>
              <span>512x512px</span>
            </div>
            <div class="status-item">
              <i class="fas fa-file-image"></i>
              <span>PNG con transparencia</span>
            </div>
            <div class="status-item">
              <i class="fas fa-magic"></i>
              <span>Modo Profesional</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="app-footer">
      <p>Chrono Legends Sprite Studio PRO v3.2.1 | Sistema de generación de sprites para uso personal y educativo</p>
      <p style="font-size: 0.85rem; margin-top: 5px; color: rgba(255, 255, 255, 0.6);">
        <i class="fas fa-exclamation-circle"></i> Esta herramienta está diseñada para crear sprites originales inspirados en juegos clásicos. 
        No use activos protegidos por derechos de autor sin permiso.
      </p>
    </div>
  </div>

  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notification-message">Sprite generado exitosamente!</span>
  </div>

  <div class="loading" id="loading">
    <div class="spinner-container">
      <div class="spinner"></div>
      <div class="spinner-inner"></div>
    </div>
    <div class="loading-text">Generando Sprite Profesional</div>
    <div class="loading-subtext">Aplicando efectos mágicos avanzados, optimizando detalles y preparando archivo para exportación...</div>
    <div class="progress-bar">
      <div class="progress" id="progress-bar"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Constantes y variables globales
      const canvas = document.getElementById('sprite-canvas');
      const ctx = canvas.getContext('2d');
      const fileInput = document.getElementById('file-input');
      const browseBtn = document.getElementById('browse-btn');
      const dropArea = document.getElementById('drop-area');
      const generateBtn = document.getElementById('save-project-btn');
      const downloadBtn = document.getElementById('export-btn');
      const resetBtn = document.getElementById('reset-btn');
      const notification = document.getElementById('notification');
      const notificationMessage = document.getElementById('notification-message');
      const loading = document.getElementById('loading');
      const progressBar = document.getElementById('progress-bar');
      
      // Estado de la aplicación
      const state = {
        currentImage: null,
        currentStyle: 'warrior',
        currentWeapon: 'sword',
        currentEffect: 'fire',
        currentAnimation: 'idle',
        currentColor: '#60a5fa',
        effectIntensity: 75,
        brightness: 65,
        smoothness: 40,
        activeLayer: 'all',
        animationFrame: 1,
        hasGenerated: false,
        projectHistory: [],
        currentProject: null
      };

      // Inicializar canvas
      initCanvas();

      // Event listeners
      setupEventListeners();

      // Función para inicializar el canvas
      function initCanvas() {
        ctx.fillStyle = 'rgba(15, 23, 42, 0.9)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Dibujar cuadrícula de fondo para mejor visualización
        drawGrid();
        
        // Dibujar indicador de centro
        drawCenterIndicator();
      }

      function drawGrid() {
        ctx.strokeStyle = 'rgba(79, 70, 229, 0.1)';
        ctx.lineWidth = 1;
        
        // Líneas verticales
        for (let x = 0; x <= canvas.width; x += 32) {
          ctx.beginPath();
          ctx.moveTo(x, 0);
          ctx.lineTo(x, canvas.height);
          ctx.stroke();
        }
        
        // Líneas horizontales
        for (let y = 0; y <= canvas.height; y += 32) {
          ctx.beginPath();
          ctx.moveTo(0, y);
          ctx.lineTo(canvas.width, y);
          ctx.stroke();
        }
      }

      function drawCenterIndicator() {
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        
        // Línea vertical central
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, 0);
        ctx.lineTo(canvas.width / 2, canvas.height);
        ctx.stroke();
        
        // Línea horizontal central
        ctx.beginPath();
        ctx.moveTo(0, canvas.height / 2);
        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.stroke();
        
        ctx.setLineDash([]);
      }

      function setupEventListeners() {
        // Eventos de arrastrar y soltar
        setupDragAndDrop();
        
        // Eventos de botones
        browseBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        
        // Eventos de estilo
        document.querySelectorAll('.style-card').forEach(card => {
          card.addEventListener('click', function() {
            document.querySelectorAll('.style-card').forEach(c => c.classList.remove('selected'));
            this.classList.add('selected');
            
            if (this.dataset.style) {
              state.currentStyle = this.dataset.style;
            } else if (this.dataset.weapon) {
              state.currentWeapon = this.dataset.weapon;
            }
            
            if (state.hasGenerated) {
              generateSpriteWithProgress();
            }
          });
        });
        
        // Eventos de color
        document.querySelectorAll('.color-swatch').forEach(swatch => {
          swatch.addEventListener('click', function() {
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));
            this.classList.add('selected');
            state.currentColor = this.dataset.color;
            
            if (state.hasGenerated) {
              generateSpriteWithProgress();
            }
          });
        });
        
        // Eventos de sliders
        document.getElementById('effect-intensity').addEventListener('input', function() {
          state.effectIntensity = parseInt(this.value);
          document.getElementById('effect-intensity-value').textContent = this.value + '%';
          if (state.hasGenerated) previewChanges();
        });
        
        document.getElementById('brightness').addEventListener('input', function() {
          state.brightness = parseInt(this.value);
          document.getElementById('brightness-value').textContent = this.value + '%';
          if (state.hasGenerated) previewChanges();
        });
        
        document.getElementById('smoothness').addEventListener('input', function() {
          state.smoothness = parseInt(this.value);
          document.getElementById('smoothness-value').textContent = this.value + '%';
          if (state.hasGenerated) previewChanges();
        });
        
        // Eventos de tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            
            // Actualizar botones de tabs
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Actualizar contenido de tabs
            document.querySelectorAll('.tab-content').forEach(content => {
              content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');
          });
        });
        
        // Eventos de capas
        document.querySelectorAll('.layer-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            document.querySelectorAll('.layer-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            state.activeLayer = this.dataset.layer;
            
            if (state.hasGenerated) {
              generateSpriteWithProgress();
            }
          });
        });
        
        // Eventos de animación
        document.querySelectorAll('.animation-frame').forEach(frame => {
          frame.addEventListener('click', function() {
            document.querySelectorAll('.animation-frame').forEach(f => f.classList.remove('active'));
            this.classList.add('active');
            state.animationFrame = parseInt(this.textContent);
            
            if (state.hasGenerated) {
              generateSpriteWithProgress();
            }
          });
        });
        
        // Eventos de efectos
        document.querySelectorAll('.preset-card').forEach(card => {
          card.addEventListener('click', function() {
            document.querySelectorAll('.preset-card').forEach(c => c.style.opacity = '0.7');
            this.style.opacity = '1';
            state.currentEffect = this.dataset.effect;
            
            if (state.hasGenerated) {
              generateSpriteWithProgress();
            }
          });
        });
        
        // Eventos de botones principales
        downloadBtn.addEventListener('click', exportSprite);
        resetBtn.addEventListener('click', resetEditor);
        document.getElementById('new-project-btn').addEventListener('click', newProject);
        document.getElementById('open-project-btn').addEventListener('click', openProject);
        document.getElementById('save-project-btn').addEventListener('click', saveProject);
      }

      function setupDragAndDrop() {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          dropArea.addEventListener(eventName, preventDefaults, false);
          document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
          dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
          dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
          dropArea.classList.add('drag-over');
        }

        function unhighlight() {
          dropArea.classList.remove('drag-over');
        }

        dropArea.addEventListener('drop', handleDrop, false);
      }

      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length) {
          handleFiles(files);
        }
      }

      function handleFileSelect(e) {
        handleFiles(e.target.files);
      }

      function handleFiles(files) {
        if (files.length === 0) return;
        
        const file = files[0];
        
        if (!file.type.match('image.*')) {
          showNotification('Por favor selecciona una imagen válida', 'error');
          return;
        }
        
        if (file.size > 10 * 1024 * 1024) {
          showNotification('La imagen es demasiado grande (máximo 10MB)', 'error');
          return;
        }
        
        const reader = new FileReader();
        
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            state.currentImage = img;
            previewBaseImage();
            showNotification('Imagen cargada exitosamente!');
            state.hasGenerated = false;
          };
          img.src = e.target.result;
        };
        
        reader.readAsDataURL(file);
      }

      function previewBaseImage() {
        if (!state.currentImage) return;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
        drawCenterIndicator();
        
        // Calcular dimensiones manteniendo proporciones
        const aspectRatio = state.currentImage.width / state.currentImage.height;
        let drawWidth = canvas.width * 0.7;
        let drawHeight = drawWidth / aspectRatio;
        
        if (drawHeight > canvas.height * 0.7) {
          drawHeight = canvas.height * 0.7;
          drawWidth = drawHeight * aspectRatio;
        }
        
        const x = (canvas.width - drawWidth) / 2;
        const y = (canvas.height - drawHeight) / 2;
        
        // Dibujar sombra suave
        ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
        ctx.shadowBlur = 20;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 5;
        
        ctx.drawImage(state.currentImage, x, y, drawWidth, drawHeight);
        
        // Resetear sombra
        ctx.shadowColor = 'transparent';
        ctx.shadowBlur = 0;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;
      }

      function previewChanges() {
        // Función ligera para previsualizar cambios sin la carga completa de generación
        requestAnimationFrame(() => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          drawGrid();
          drawCenterIndicator();
          
          if (state.currentImage) {
            const aspectRatio = state.currentImage.width / state.currentImage.height;
            let drawWidth = canvas.width * 0.7;
            let drawHeight = drawWidth / aspectRatio;
            
            if (drawHeight > canvas.height * 0.7) {
              drawHeight = canvas.height * 0.7;
              drawWidth = drawHeight * aspectRatio;
            }
            
            const x = (canvas.width - drawWidth) / 2;
            const y = (canvas.height - drawHeight) / 2;
            
            // Aplicar efectos de brillo y suavizado
            ctx.filter = `brightness(${(state.brightness + 50) / 100}) contrast(1.1)`;
            ctx.drawImage(state.currentImage, x, y, drawWidth, drawHeight);
            ctx.filter = 'none';
          }
          
          // Mostrar indicador de previsualización
          ctx.fillStyle = 'rgba(79, 70, 229, 0.3)';
          ctx.font = '14px Arial';
          ctx.textAlign = 'center';
          ctx.fillText('Vista previa - Parámetros actualizados', canvas.width / 2, canvas.height - 20);
        });
      }

      function generateSpriteWithProgress() {
        showLoading(true);
        let progress = 0;
        
        // Simular progreso para mejor experiencia de usuario
        const progressInterval = setInterval(() => {
          progress += Math.random() * 10;
          if (progress > 90) progress = 90;
          progressBar.style.width = `${progress}%`;
        }, 100);
        
        setTimeout(() => {
          clearInterval(progressInterval);
          generateSprite();
          progressBar.style.width = '100%';
          
          setTimeout(() => {
            showLoading(false);
            progressBar.style.width = '0%';
            showNotification('Sprite actualizado con los nuevos parámetros!');
          }, 300);
        }, 1500);
      }

      function generateSprite() {
        if (!state.currentImage) {
          showNotification('Primero sube una imagen para generar el sprite', 'error');
          return;
        }
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Dibujar fondo según estilo
        drawBackground();
        
        // Calcular dimensiones del personaje
        const aspectRatio = state.currentImage.width / state.currentImage.height;
        let drawWidth = canvas.width * 0.65;
        let drawHeight = drawWidth / aspectRatio;
        
        if (drawHeight > canvas.height * 0.65) {
          drawHeight = canvas.height * 0.65;
          drawWidth = drawHeight * aspectRatio;
        }
        
        const x = (canvas.width - drawWidth) / 2;
        const y = (canvas.height - drawHeight) / 2 + 10; // Ajuste vertical para mejor composición
        
        // Dibujar personaje con efectos
        drawCharacter(x, y, drawWidth, drawHeight);
        
        // Dibujar arma según estilo
        if (state.activeLayer === 'all' || state.activeLayer === 'weapon') {
          drawWeapon(x + drawWidth * 0.6, y + drawHeight * 0.4, drawHeight * 0.4);
        }
        
        // Dibujar efectos mágicos
        if (state.activeLayer === 'all' || state.activeLayer === 'effects') {
          drawMagicEffects(x, y, drawWidth, drawHeight);
        }
        
        // Añadir detalles finales y contornos
        addFinalDetails(x, y, drawWidth, drawHeight);
        
        state.hasGenerated = true;
        addProjectHistory();
      }

      function drawBackground() {
        // Fondo degradado según estilo
        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        
        switch(state.currentStyle) {
          case 'warrior':
            gradient.addColorStop(0, '#0f172a');
            gradient.addColorStop(1, '#1e40af');
            break;
          case 'mage':
            gradient.addColorStop(0, '#0f172a');
            gradient.addColorStop(1, '#7c3aed');
            break;
          case 'archer':
            gradient.addColorStop(0, '#0f172a');
            gradient.addColorStop(1, '#166534');
            break;
          case 'rogue':
            gradient.addColorStop(0, '#0f172a');
            gradient.addColorStop(1, '#1e293b');
            break;
          case 'priest':
            gradient.addColorStop(0, '#0f172a');
            gradient.addColorStop(1, '#1d4ed8');
            break;
          case 'assassin':
            gradient.addColorStop(0, '#0f172a');
            gradient.addColorStop(1, '#92400e');
            break;
          default:
            gradient.addColorStop(0, '#0f172a');
            gradient.addColorStop(1, '#1e293b');
        }
        
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Añadir patrón sutil al fondo
        ctx.fillStyle = 'rgba(255, 255, 255, 0.03)';
        for (let i = 0; i < canvas.width; i += 20) {
          for (let j = 0; j < canvas.height; j += 20) {
            if ((i + j) % 40 === 0) {
              ctx.beginPath();
              ctx.arc(i, j, 2, 0, Math.PI * 2);
              ctx.fill();
            }
          }
        }
      }

      function drawCharacter(x, y, width, height) {
        // Aplicar efectos de color según estilo
        ctx.save();
        
        // Efecto de brillo
        ctx.filter = `brightness(${(state.brightness + 50) / 100}) contrast(1.1)`;
        
        // Dibujar personaje base
        ctx.drawImage(state.currentImage, x, y, width, height);
        
        // Añadir efecto de contorno brillante
        if (state.effectIntensity > 30) {
          ctx.globalCompositeOperation = 'lighter';
          ctx.shadowColor = state.currentColor;
          ctx.shadowBlur = 15 + (state.effectIntensity / 10);
          
          // Dibujar contorno brillante
          ctx.drawImage(state.currentImage, x, y, width, height);
          
          ctx.shadowBlur = 0;
          ctx.globalCompositeOperation = 'source-over';
        }
        
        ctx.filter = 'none';
        ctx.restore();
      }

      function drawWeapon(x, y, size) {
        ctx.save();
        ctx.translate(x, y);
        
        switch(state.currentWeapon) {
          case 'sword':
            drawSword(size);
            break;
          case 'staff':
            drawStaff(size);
            break;
          case 'bow':
            drawBow(size);
            break;
          case 'axe':
            drawAxe(size);
            break;
          case 'dagger':
            drawDagger(size);
            break;
          case 'hammer':
            drawHammer(size);
            break;
        }
        
        ctx.restore();
      }

      function drawSword(size) {
        // Hoja
        ctx.beginPath();
        ctx.moveTo(0, -size/2);
        ctx.lineTo(size/4, size/4);
        ctx.lineTo(0, size/2);
        ctx.closePath();
        const gradient = ctx.createLinearGradient(0, -size/2, 0, size/2);
        gradient.addColorStop(0, '#a5b4fc');
        gradient.addColorStop(0.5, '#60a5fa');
        gradient.addColorStop(1, '#3b82f6');
        ctx.fillStyle = gradient;
        ctx.fill();
        
        // Brillo en la hoja
        ctx.beginPath();
        ctx.moveTo(size/8, -size/3);
        ctx.lineTo(size/8, size/3);
        ctx.lineTo(-size/16, size/4);
        ctx.closePath();
        ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
        ctx.fill();
        
        // Empuñadura
        ctx.beginPath();
        ctx.rect(-size/8, size/2, size/4, size/4);
        ctx.fillStyle = '#f59e0b';
        ctx.fill();
        
        // Protector de mano
        ctx.beginPath();
        ctx.rect(-size/4, size/2 - size/8, size/2, size/8);
        ctx.fillStyle = '#64748b';
        ctx.fill();
        
        // Detalle del protector
        ctx.beginPath();
        ctx.arc(0, size/2 - size/16, size/16, 0, Math.PI * 2);
        ctx.fillStyle = '#4b5563';
        ctx.fill();
      }

      function drawStaff(size) {
        // Parte superior (esfera mágica)
        const gradient = ctx.createRadialGradient(0, -size/2, 0, 0, -size/2, size/4);
        gradient.addColorStop(0, '#c084fc');
        gradient.addColorStop(0.7, '#8b5cf6');
        gradient.addColorStop(1, '#7c3aed');
        
        ctx.beginPath();
        ctx.arc(0, -size/2, size/4, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();
        
        // Brillo en la esfera
        ctx.beginPath();
        ctx.arc(size/8, -size/2 - size/8, size/10, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
        ctx.fill();
        
        // Varita
        ctx.beginPath();
        ctx.rect(-size/16, -size/2 + size/4, size/8, size);
        ctx.fillStyle = '#4f46e5';
        ctx.fill();
        
        // Detalles en la varita
        for (let i = 0; i < 4; i++) {
          const y = -size/2 + size/4 + i * size/4;
          ctx.beginPath();
          ctx.moveTo(-size/8, y);
          ctx.lineTo(size/8, y);
          ctx.strokeStyle = '#818cf8';
          ctx.lineWidth = 2;
          ctx.stroke();
        }
      }

      function drawBow(size) {
        // Arco
        ctx.beginPath();
        ctx.moveTo(-size/2, 0);
        ctx.quadraticCurveTo(0, -size/1.5, size/2, 0);
        ctx.strokeStyle = '#22c55e';
        ctx.lineWidth = 8;
        ctx.stroke();
        
        // Cuerda
        ctx.beginPath();
        ctx.moveTo(-size/2 + 5, 0);
        ctx.lineTo(size/2 - 5, 0);
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // Detalles del arco
        ctx.beginPath();
        ctx.moveTo(-size/2, 5);
        ctx.lineTo(-size/2, -5);
        ctx.strokeStyle = '#64748b';
        ctx.lineWidth = 4;
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(size/2, 5);
        ctx.lineTo(size/2, -5);
        ctx.strokeStyle = '#64748b';
        ctx.lineWidth = 4;
        ctx.stroke();
        
        // Flecha (solo si es frame de ataque)
        if (state.currentAnimation === 'attack' && state.animationFrame > 3) {
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.lineTo(size/1.5, 0);
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
          ctx.lineWidth = 3;
          ctx.stroke();
          
          // Punta de la flecha
          ctx.beginPath();
          ctx.moveTo(size/1.5, 0);
          ctx.lineTo(size/1.5 - 10, -5);
          ctx.lineTo(size/1.5 - 10, 5);
          ctx.closePath();
          ctx.fillStyle = '#f59e0b';
          ctx.fill();
        }
      }

      function drawMagicEffects(x, y, width, height) {
        const centerX = x + width/2;
        const centerY = y + height/2;
        const radius = Math.min(width, height) * 0.5;
        
        // Efecto de aura según tipo seleccionado
        switch(state.currentEffect) {
          case 'fire':
            drawFireAura(centerX, centerY, radius);
            break;
          case 'ice':
            drawIceAura(centerX, centerY, radius);
            break;
          case 'lightning':
            drawLightningAura(centerX, centerY, radius);
            break;
          case 'poison':
            drawPoisonAura(centerX, centerY, radius);
            break;
          case 'holy':
            drawHolyAura(centerX, centerY, radius);
            break;
          case 'shadow':
            drawShadowAura(centerX, centerY, radius);
            break;
        }
        
        // Partículas mágicas adicionales
        drawMagicParticles(centerX, centerY, radius);
      }

      function drawFireAura(centerX, centerY, radius) {
        const particles = 15 + Math.floor(state.effectIntensity / 10);
        
        for (let i = 0; i < particles; i++) {
          const angle = (i / particles) * Math.PI * 2;
          const distance = radius * (0.7 + Math.random() * 0.3);
          const x = centerX + Math.cos(angle) * distance;
          const y = centerY + Math.sin(angle) * distance;
          const size = 5 + Math.random() * 15;
          
          const gradient = ctx.createRadialGradient(x, y, 0, x, y, size);
          gradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
          gradient.addColorStop(0.3, 'rgba(255, 165, 0, 0.8)');
          gradient.addColorStop(0.7, 'rgba(255, 69, 0, 0.7)');
          gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
          
          ctx.beginPath();
          ctx.arc(x, y, size, 0, Math.PI * 2);
          ctx.fillStyle = gradient;
          ctx.fill();
        }
      }

      function drawMagicParticles(centerX, centerY, radius) {
        const particleCount = 30 + Math.floor(state.effectIntensity / 5);
        
        for (let i = 0; i < particleCount; i++) {
          const angle = Math.random() * Math.PI * 2;
          const distance = (radius * 0.3) + Math.random() * (radius * 0.7);
          const x = centerX + Math.cos(angle) * distance;
          const y = centerY + Math.sin(angle) * distance;
          const size = Math.random() * 4 + 1;
          const opacity = 0.3 + Math.random() * 0.7;
          
          ctx.beginPath();
          ctx.arc(x, y, size, 0, Math.PI * 2);
          
          // Color de partícula según estilo
          let particleColor;
          switch(state.currentStyle) {
            case 'warrior': particleColor = '#60a5fa'; break;
            case 'mage': particleColor = '#8b5cf6'; break;
            case 'archer': particleColor = '#22c55e'; break;
            case 'rogue': particleColor = '#f59e0b'; break;
            case 'priest': particleColor = '#3b82f6'; break;
            case 'assassin': particleColor = '#f97316'; break;
            default: particleColor = '#60a5fa';
          }
          
          ctx.fillStyle = `rgba(${parseInt(particleColor.slice(1,3),16)}, ${parseInt(particleColor.slice(3,5),16)}, ${parseInt(particleColor.slice(5,7),16)}, ${opacity})`;
          ctx.fill();
        }
      }

      function addFinalDetails(x, y, width, height) {
        // Añadir ojos brillantes
        const eyeY = y + height * 0.35;
        const eyeOffset = width * 0.15;
        const eyeSize = width * 0.05;
        
        // Ojo izquierdo
        ctx.beginPath();
        ctx.arc(x + eyeOffset, eyeY, eyeSize, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.fill();
        
        // Brillo en ojo izquierdo
        ctx.beginPath();
        ctx.arc(x + eyeOffset - eyeSize/3, eyeY - eyeSize/3, eyeSize/3, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
        ctx.fill();
        
        // Ojo derecho
        ctx.beginPath();
        ctx.arc(x + width - eyeOffset, eyeY, eyeSize, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.fill();
        
        // Brillo en ojo derecho
        ctx.beginPath();
        ctx.arc(x + width - eyeOffset + eyeSize/3, eyeY - eyeSize/3, eyeSize/3, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
        ctx.fill();
        
        // Contorno de calidad profesional
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.lineWidth = 2;
        ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
        
        ctx.strokeStyle = 'rgba(79, 70, 229, 0.7)';
        ctx.lineWidth = 1.5;
        ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
        
        // Efecto de brillo en esquinas
        drawCornerHighlights();
        
        // Añadir marca de agua sutil
        ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.font = '12px Arial';
        ctx.textAlign = 'right';
        ctx.fillText('Chrono Legends PRO', canvas.width - 15, canvas.height - 10);
      }

      function drawCornerHighlights() {
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
        ctx.lineWidth = 1;
        
        // Esquina superior izquierda
        ctx.beginPath();
        ctx.moveTo(15, 15);
        ctx.lineTo(35, 15);
        ctx.lineTo(15, 35);
        ctx.stroke();
        
        // Esquina superior derecha
        ctx.beginPath();
        ctx.moveTo(canvas.width - 15, 15);
        ctx.lineTo(canvas.width - 35, 15);
        ctx.lineTo(canvas.width - 15, 35);
        ctx.stroke();
        
        // Esquina inferior izquierda
        ctx.beginPath();
        ctx.moveTo(15, canvas.height - 15);
        ctx.lineTo(35, canvas.height - 15);
        ctx.lineTo(15, canvas.height - 35);
        ctx.stroke();
        
        // Esquina inferior derecha
        ctx.beginPath();
        ctx.moveTo(canvas.width - 15, canvas.height - 15);
        ctx.lineTo(canvas.width - 35, canvas.height - 15);
        ctx.lineTo(canvas.width - 15, canvas.height - 35);
        ctx.stroke();
      }

      function exportSprite() {
        if (!state.hasGenerated) {
          showNotification('Primero genera un sprite para poder exportarlo', 'error');
          return;
        }
        
        // Crear sprite sheet para animaciones
        if (state.currentAnimation !== 'idle') {
          createSpriteSheet();
        } else {
          // Exportar sprite simple
          const link = document.createElement('a');
          link.download = `chrono-sprite-${state.currentStyle}-${state.currentWeapon}-${Date.now()}.png`;
          link.href = canvas.toDataURL('image/png');
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          showNotification('Sprite exportado exitosamente!');
          
          // Crear partículas mágicas de celebración
          createCelebrationParticles();
        }
      }

      function createSpriteSheet() {
        // Crear un canvas más grande para el sprite sheet
        const sheetCanvas = document.createElement('canvas');
        const sheetCtx = sheetCanvas.getContext('2d');
        sheetCanvas.width = canvas.width * 8; // 8 frames
        sheetCanvas.height = canvas.height;
        
        // Generar cada frame para la animación
        for (let frame = 1; frame <= 8; frame++) {
          state.animationFrame = frame;
          
          // Dibujar sprite en la posición correspondiente
          sheetCtx.drawImage(canvas, (frame - 1) * canvas.width, 0);
          
          // Regenerar sprite para el siguiente frame
          if (frame < 8) {
            generateSprite();
          }
        }
        
        // Restaurar el frame actual
        state.animationFrame = 1;
        generateSprite();
        
        // Exportar sprite sheet
        const link = document.createElement('a');
        link.download = `chrono-sprite-sheet-${state.currentAnimation}-${Date.now()}.png`;
        link.href = sheetCanvas.toDataURL('image/png');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification(`Sprite sheet de animación (${state.currentAnimation}) exportado con 8 frames!`);
        createCelebrationParticles();
      }

      function createCelebrationParticles() {
        // Crear 50 partículas mágicas de celebración
        for (let i = 0; i < 50; i++) {
          setTimeout(() => {
            const particle = document.createElement('div');
            particle.className = 'magic-particle';
            particle.style.left = `${Math.random() * window.innerWidth}px`;
            particle.style.top = `${window.innerHeight}px`;
            particle.style.color = `hsl(${Math.random() * 360}, 70%, 70%)`;
            particle.style.fontSize = `${Math.random() * 2 + 1}rem`;
            particle.innerHTML = ['✨', '💫', '🌟', '⚡', '🔥'][Math.floor(Math.random() * 5)];
            
            document.body.appendChild(particle);
            
            // Animar partícula
            const duration = 1000 + Math.random() * 2000;
            const animation = particle.animate([
              { transform: 'translate(0, 0) scale(0)', opacity: '0' },
              { transform: `translate(${Math.random() * 200 - 100}px, ${-window.innerHeight * 0.5}px) scale(1)`, opacity: '0.8' },
              { transform: `translate(${Math.random() * 200 - 100}px, ${-window.innerHeight}px) scale(0)`, opacity: '0' }
            ], {
              duration: duration,
              easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
            });
            
            // Eliminar partícula después de la animación
            animation.onfinish = () => {
              particle.remove();
            };
          }, i * 30); // Stagger the particles
        }
      }

      function resetEditor() {
        state.currentImage = null;
        state.hasGenerated = false;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        initCanvas();
        
        showNotification('Editor reiniciado exitosamente!');
      }

      function newProject() {
        resetEditor();
        showNotification('Nuevo proyecto creado!');
      }

      function openProject() {
        showNotification('Funcionalidad de apertura de proyectos en desarrollo', 'warning');
      }

      function saveProject() {
        if (!state.hasGenerated) {
          showNotification('Genera un sprite primero para poder guardarlo', 'error');
          return;
        }
        
        generateSpriteWithProgress();
      }

      function addProjectHistory() {
        // Guardar estado actual en el historial
        const projectState = {
          style: state.currentStyle,
          weapon: state.currentWeapon,
          effect: state.currentEffect,
          animation: state.currentAnimation,
          color: state.currentColor,
          effectIntensity: state.effectIntensity,
          brightness: state.brightness,
          smoothness: state.smoothness,
          timestamp: new Date().toISOString()
        };
        
        state.projectHistory.unshift(projectState);
        
        // Limitar historial a 10 proyectos
        if (state.projectHistory.length > 10) {
          state.projectHistory.pop();
        }
      }

      function showNotification(message, type = 'success') {
        notificationMessage.textContent = message;
        notification.className = 'notification';
        
        if (type === 'error') {
          notification.classList.add('error');
          notification.querySelector('i').className = 'fas fa-exclamation-circle';
        } else if (type === 'warning') {
          notification.classList.add('warning');
          notification.querySelector('i').className = 'fas fa-exclamation-triangle';
        } else {
          notification.classList.add('success');
          notification.querySelector('i').className = 'fas fa-check-circle';
        }
        
        notification.classList.add('show');
        
        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      }

      function showLoading(show) {
        loading.style.display = show ? 'flex' : 'none';
      }

      // Inicializar con un sprite de demostración
      setTimeout(() => {
        // Crear imagen de demostración
        const demoImg = new Image();
        demoImg.onload = function() {
          state.currentImage = demoImg;
          previewBaseImage();
          setTimeout(() => {
            generateSpriteWithProgress();
            showNotification('¡Bienvenido a Chrono Legends Sprite Studio PRO! Carga tu imagen o usa esta demostración.', 'warning');
          }, 500);
        };
        
        // Usar un canvas para crear una imagen de demostración
        const demoCanvas = document.createElement('canvas');
        demoCanvas.width = 200;
        demoCanvas.height = 300;
        const demoCtx = demoCanvas.getContext('2d');
        
        // Dibujar un personaje de demostración simple
        demoCtx.fillStyle = '#60a5fa';
        demoCtx.fillRect(75, 50, 50, 150); // Cuerpo
        
        demoCtx.fillStyle = '#4f46e5';
        demoCtx.fillRect(70, 50, 60, 30); // Cabeza
        
        demoCtx.fillStyle = '#2563eb';
        demoCtx.fillRect(75, 200, 20, 60); // Pierna izquierda
        demoCtx.fillRect(105, 200, 20, 60); // Pierna derecha
        
        demoCtx.fillStyle = '#1d4ed8';
        demoCtx.fillRect(45, 120, 30, 15); // Brazo izquierdo
        demoCtx.fillRect(125, 120, 30, 15); // Brazo derecho
        
        // Convertir canvas a imagen
        demoImg.src = demoCanvas.toDataURL();
        
        // Mostrar mensaje de bienvenida con partículas
        setTimeout(createCelebrationParticles, 1000);
      }, 300);
    });
  </script>
</body>
</html>
```
